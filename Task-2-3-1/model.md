# Модель
## Объекты
* __Задача:__
    * Название
        - Строковое значение в следующем формате: Краткое имя\_Номер семестра\_Номер блока задач\_Номер задачи
        -  __Пример:__ Snake\_2\_2\_1
    * Количнствово баллов за задачу - целое число
        - Количество баллов, которое можно получить за решение задачи без доп условий и в срок.
    * Можно добавить новое задание следующим образом:
        - with_name "Название задания"
        - with_points "Количество баллов за сдачу задачи"
        - __Пример:__
            ```groovy
            add task with_name "Snake_2_2_1" with_points 2 
            ```
        - Вводить параметры можно в любом порядке.
* __Группа:__
    * Номер
        - Целое число
        - __Пример:__ 18214
    * Список студендов
    * Создание новой группы:
        - with_number "номер группы"
        - __Пример:__
            ```groovy
            add group with_number 18214 
            ```
        - Вводить параметры можно в любом порядке.
* __Студент:__
    * Имя
        - Строковое значение
        - __Пример:__ "Yakovlev Arthur"
    * ID
        - Уникальный ID для идентификации студента
        - __Пример:__ "ayakovlev"
    * Repository URL
        - URL адрес репозитория студента.
        - __Пример:__
        "https://github.com/ayakovlev18214/OOP"
    * Список сданных задач
        - Список задач, которые были засчитаны студенту.
        - Каждая запись содержит Имя задания, дату сдачи (Date), а также количество баллов за эту задачу.
    * Добавление новых студентов:
        - with_name "Имя"
        - with_id "Уникальный ID"
        - with_rep "URL репозитория"
        - to "Номер группы"
        - _Пример:__
            ```groovy
            add student with_name "Arthur" with_id "ayakovlev" with_rep "https://github.com/" to 18214
            ```
       - Вводить параметры можно в любом порядке.
    * Чтобы засчитать студенту задание, необходимо использовать следующую конструкцию:
        - accept "Name задачи"
        - for_student "Уникальный ID студента"
        - on "Дата сдачи задачи в формате ДД.ММ.ГГГ"
        - with "Количество баллов за сдачу"
        - Последнее - является опциональным (Использовать, если необходимо поставить не стандартное количество баллов за задачу)
        - __Пример:__
            ```groovy
            accept "Snake-2-2-1" for_student "ayakovelvev" on "07.06.2020" with 500
            ```
        - Вводить параметры можно в любом порядке.
* __Контрольная точка:__
    * Дата:
        - День, когда оценка студенту будет выставлена.
    * Шкала оценивания:
        - Сколько необходимо баллов на 3, 4, 5
    * Для добавления контрольной точки нужно:
        - add control_point - добавить контрольную точку
        - sat "кол-во баллов на 3"
        - good "кол-во баллов на 4"
        - exc "кол-во баллов на 5"
        - on "дата в формате ДД.ММ.ГГГГ"
        - __Пример:__
            ```groovy
            add control_point sat 5 good 7 exc 10 on "07.05.2020"
            ```
        - Вводить параметры можно в любом порядке.
* __Семинары:__
    * Дата
        - Типа Date
    * Список присутствующих студентов
        - Есть возможность проставить присутствие на семинаре в ручном режиме. Автоматически же присутствие проставится по наличию коммитов за неделю до семинара.
    * Есть два способа добавить семинары: (можно несколько раз использовать оба в одном конфиге)
        *   Первый случай, если вы хотите доавить семинар на конкретную дату:
            - on "Дата проведения семинара"
            - for_group "ID группы, у которой семинар"
                ```groovy
                add lesson on "07.05.2020" for_group 18214
                ```
        *   Второй случай, если вы знаете, что семинары будут каждые N дней:
            - for_group "ID группы, у которой семинар"
            - from "Дата первого семинара в формате dd.mm.yyyy"
            - to "Последний день обучения в формате dd.mm.yyyy"
            - every "Каждые сколько дней проходит семинар"
                ```groovy
                add lesson for_group 18214 from "04.02.2020" to "31.05.2020" every 7
                ```
            В случае использования нескольких подобных записей, например 
            ```groovy
                add lesson for_group 18214 from "04.02.2020" to "31.03.2020" every 7
                add lesson for_group 18214 from "04.04.2020" to "31.05.2020" every 7
            ```
            все семинары будут добавлены в конфигурацию (произойдет объединение)
        * В любом случае порядок аргументов не важен.
    * Для изменения статуса присутствия студента на семинаре нужно использовать следующее:
        - Если студент присутствовал:
            ```groovy
            present "ayakovlev" on "07.05.2020" in_group 18214
            ```
        - Если отсутствовал:
            ```groovy
            absent "ayakovlev" on "07.05.2020" in_group 18214
            ```
        - Вводить параметры после absent/present "name" можно в любом порядке.
## Процессы

### Заполнение объектов:
    В момент запуска JAR, программа пытается открыть файл config.nsu. Если его не существует, то пытается открыть файл, который был передан в качестве аргумента после ключа -c.  
    Груви считывает DSL и заполняет объекты, которые уже в свою очередь могут использовать Java классы.
    Все джава классы с бизнес-логикой приложения используют классы и объекты классов DSL.
    В классе EngineDSL есть единственный метод executeDSL, принимающий путь до конфигурационного файла.
    Внутри него создается GroovyShell с конфигурацией DSL, которая лежит в классе LangDSL.
    От GroovyShell'a вызывается метод evaluate, ему на вход передается открытый файл 
    (в случае, если файл открыть невозможно, бросается FileNotFoundException)
    Из метода возвращается готовый DSL объект.
### Скачать репозитории студентов: (Подзадача при генерации отчета)
    Проходимся по всем студентам и от каждого из них вызываем метод
    downloadRepository(student.getRepUrl())
    Если в текущей директории нет папки с текущим repUrl то:
        Внутри происходит создание подпроцесса с командой git clone "URL репозитория студента".
        В случае неудачи - пишет сообщение в stdout "Невозможно клонировать репозиторий: " + repUrl 
        и возвращает fasle.
        После получения false - программа продолжает пытаться отработать остальные команды 
        промуская текущего студента.
        Иначе, метод возвращает true.
    Иначе, если директория существует:
        Внутри происходит создание подпроцесса с командой git fetch
        В случае неудачи - пишет сообщение в stdout "Невозможно обновить репозиторий: " + repUrl 
        и возвращает fasle.
        После получения false - программа продолжает пытаться отработать остальные команды
        пропуская этого студента.
        Иначе, метод возвращает true.
### Сборка программы: (Подзадача при генерации отчета)
    Если пользователь запросит сборку программы, будет вызван метод
    buildTask(String taskName, Student student)
    Внутри происхдит создание подпроцесса в директории с именем задачи, 
    где имя задачи - строка, состоящая из трех последних цифр краткого имени Task'a
    разделенных минусами.
    Далее подпроцесс исполняет команду gradle build, читая и разбирая вывод.
    В случае BUILD SUCCESS, возвращает True.
    В ином случае метод вернет False, а также в отчете в соответствующей графе будет стоять "-"
### Генерация документации (Подзадача при генерации отчета)
    Если пользователь запросить генерацию документации для task, вызывается метод 
    generateDocs(String taskName, Student student)
    Внутри в папке с задачей создается подпроцесс, который вызывае команду gradlew javadoc.
    Если удалось создать докумментацию успешно - вернет True.
    В случае неудачи, в таблице с отчетом в соответствующей колонке будет стоять минус.
### Проверка codestyle (Подзадача при генерации отчета)
    Если пользователь запросит проверку код-стайла, то для задачи вызывается метод 
    checkCodestyle(String taskName, Student student)
    У студента в build.gradle должен быть импортирован плагин codestyle, 
    (иначе, студент получит минус в соответствующей графе в отчете, 
    а значит, его задачу нельзя начать принимать)
    а также должна быть папка config,
    в которой должен лежать .xml файл, который содержит google codestyle.
    Если ошибок нет - вернет True.
    Иначе, как и всегда, в соответствующей графе отчета будет стоять минус.
### Запуск тестов (Подзадача при генерации отчета)
    Для задачи можно проверить, проходит ли она unit-тесты, вызвав функцию 
    runTests(String taskName, Student student)
    Создается подпроцесс, который вызывает команду gradlew test
    Для того, чтобы проходились все тесты, даже если один из них упадет в процессе проверки,
    необходимо, чтобы у студента задание gradle test было описано корректно.
    Нужно, чтобы свойство ignoreFailures было равно true.
    Обратно в программу метод возвращает массив из 3х чисел, где первое - кол-во успешных,
    второе - пропущенных и третье - проваленных. Причину ошибок увидеть нельзя, так как эта задача нужна нам только для генерации отчета.
### Генерация отчета
    Проход по всем студентам из группы:
    
    Отчет по успеваемости
    1. Просматривается список выполненых заданий
    2. Подсчитывается количество баллов на каждую контрольную точку
    3. За каждую контрольную точку выставляется оценка  
    4. Скачивается или обновляются репозитории (См "Скачать репозитории студентов")
    5. С каждой задачей происходят следующие операции:
        1. Сборка
        2. Тесты
        3. Проверка кодстайла
        4. Генерация документации
    6. Успех или неудача каждого из выше перечислинных пунктов вносится в таблицу,
       которая в итоге будет выведена в виде HTML таблицы.
    
    Отчет по посещаемости
    1. Просматривается каждое занятие
    2. Если посещение для студента не проставлено в ручном режиме:
        - В репозитории пользователя проверяется наличие коммитов не более чем за неделю до занятия
            - Создается подпроцесс, отрабатывающий команду git rev-list --count --all --since="Дата семинара - одна неделя" --before="Дата семинара" 
        -  Если коммиты есть, ставится посещение, иначе пропуск.
    3. Все данные вносятся в выходной файл
        - Выходной файл - таблица в формате HTML.
        - В папке, откуда был вызван jar создается файл "report.html" (Если в момент запуска не было ключа -o "path/to/report")
        - В этот файл записывается таблица. 



### Формат отчета
    Отчет состоит из двух таблиц (опционально, можно получить одну из них).
    Первая таблица - таблица успеваемости студента группы, для которой необходимо сгенерировать отчет.
        Первый столбец по вертикали - полные имена (см. объект Студент) студентов из этой группы
        По горизонтали в первой строке располагаются задачи,
        После них в этой же строке - котрольные точки и финальная оценка.
        На следующей строке для каждой задачи размечены 5 столбцов для каждого из студентов:
            Build: Смогла ли задача собраться у этого студента или нет.              Формат +/-
            Style: Соотвествует ли код CodeStyle'у.                                  Формат +/-
            Doc: Генерируется ли документация.                                       Формат +/-
            Tests: Показывает количество успешных, пропущенных и проваленных тестов. Формат X/X/X
            Credit: Количество баллов, выставленное преподователем за задачу:        Формат X
        Для каждой контрольной точки, в случае, если она пройдена, у каждого студента будет стоять:
            Количество набранных баллов до контрольной точки 
            и оценка за нее по данной шкале в формате БАЛЛЫ/ОЦЕНКА
        Итоговая оценка на текущий момент ставится по правилам:
            1. Более 50% пропусков -2 балла к итоговой, более 25% -1 балл 
            2. Сама оценка = средняя оценка по всем контрольным точкам 
                с округлением вверх - баллы за пропуски
        В случае запроса только этой таблица - посещаемость все равно будет просчитана 
            для получения итоговой оценки, однако в отчет выведена не будет.
    Вторая таблица - таблица посещаемости семинарских занятий студентами группы N.
        По горизонтали в первой строке проставлены даты семинаров
            Последним - итоговая посещаемость студента за семестр в процентах.
        По вертикали в первом столбце - Имена студентов группы N.
        В остальных ячейках будет стоять +/- в зависимости от того, проставлена ли
            посещаемость студенту лично в конфигурации или же были ли у него коммиты
            в течение последней недели в учебный репозиторий.
            

## Интерфейс
* Для запуска программы достаточно в той же директории иметь файл config.nsu. Или же передать путь до него после ключа -c. Через ключ -o можно указать путь до файла, в который необходимо сохранить отчет (Файл, для корректного отображения должен быть формата HTML). Если нам необходимо сделать отчет, то достаточно передать аргументом fullReport -g <Номер группы, для которой нужен отчет>.
* Ключи:
    - -o "path/to/report" -> Путь, куда записать отчет. (Если не указан - сохранит в текущую директорию)
    - -c "path/to/config" -> Путь до конфигурационного файла.
    -  "-g " groupID" -> Номер группы, для которой выполняется запрос.
    -   -s "studentID" -> ID студента, для которого выполняется запрос.
    -   -t  "taskID" -> ID задачи, для которой выполняется запрос.
    -   fullReport -> Полный отчет с двумя таблицами для группы"
    -       После этого обязательно перечислить ключ -g
    -   attendanceOnly -> Отчет по посещаемости студентами группы
    -       После этого обязательно перечислить ключ -g
    -   performanceOnly -> Отчет по успеваемости студентами группы
    -       После этого обязательно перечислить ключ -g
    -   codestyle -> Информация по следованию кода задачи принятому кодстайлу.
    -       После этого обязательно перечислить ключи -s, -g и -t.
    -   build -> Информация по сборке данной задачи.
    -       После этого обязательно перечислить ключи -s, -g и -t.
    -   tests -> Информация по прохождению тестов данной задачи.
    -       После этого обязательно перечислить ключи -s, -g и -t.
    -   docs -> Информация по генерации документации данной задаачи.
    -       После этого обязательно перечислить ключи -s, -g и -t.
    
Сначала всегда должен идти запрос (ключ без минуса вначале).
Далее - ключи в любом порядке.

__Примеры:__
```
task-2-3-1 fullReport 18213 -c "D:\config\config.nsu" -o "D:\reports\report_01.10.2000.html"
```

```
task-2-3-1 codestyle -g 18213 -s ayakovlev -t Snake-2-2-1
```